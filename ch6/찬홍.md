# 메시지와 인터페이스

## 01 협력과 메시지

- 객체가 다른 객체에게 접근할 수 있는 유일한 방법은 **메시지 전송**
- 객체가 독립적으로 수행할 수 있는 것보다 더 큰 책임을 수행하기 위해서는 다른 객체와 협력해야 함.

**클라이언트 - 서버 모델**

- 클라이언트 : 협력 안에서 메시지를 전송하는 객체
- 서버 : 메시지를 수신하는 객체

### 메시지와 메시지 전송

- 메시지는 객체들이 협력하기 위해 사용할 수 있는 유일한 의사소통 수단
- 오퍼레이션 명과 인자로 구성되며, 메시지 전송은 여기에 메시지 수진자를 추가한 것.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3b633106-35d3-47e3-82c4-0bd61295842f/Untitled.png)

### 메시지와 메서드

- 메서드 : 메시지를 수신했을 떄 실제로 실행되는 함수 또는 프로시저
- 메시지와 메서드의 구분은 메시지 전송자와 메시지 수신자가 느슨하게 결합될 수 있게 함
- 실행 시점에 메시지와 메서드를 바인딩하는 메커니즘은 두 객체 사이의 결합도를 낮춤으로써 유연하고 확장 가능한 코드를 작성할 수 있게함.

### 퍼블릭 인터페이스와 오퍼레이션

- 퍼블릭 인터페이스 : 객체가 의사소통을 위해 외부에 공개하는 메시지의 집합
- 오퍼레이션 : 프로그래밍 언어의 관점에서 퍼블릭 인터페이스에 포함된 메시지
    - 수행 가능한 어떤 행동에 대한 추상화

### 시그니처

- 시그니처 : 오퍼레이션(또는 메서드)의 이름과 파라미터 목록을 합친 것
- 오퍼레이션은 실행 코드 없이 시그니처만을 정의한 것
- 메서드는 이 시그니처에 구현을 더한 것

---

## 02 인터페이스와 설계 품질

- 좋은 인터페이스는 **최소한의 인터페이스**와 **추상적인 인터페이스**라는 조건을 만족해야 함.
- 최소한의 인터페이스 : 꼭 필요한 오퍼레이션만을 인터페이스에 포함
- 추상적인 인터페이스 : 어떻게 수행하는지가 아니라 무엇을 하는지를 표현

## 퍼블릭 인터페이스의 품질에 영향을 미치는 원칙과 기법

1. 디미터 법칙
2. 묻지 말고 시켜라
3. 의도를 드러내는 인터페이스
4. 명령-쿼리 분리

### 1. 디미터 법칙

- 협력하는 객체의 내부 구조에 대한 결합으로 인해 발생하는 설계 문제를 해결하기 위해 제안된 원칙
- 객체의 내부 구조에 가앟게 결합되지 않도록 협력 경로를 제한하라.
- 클라이언트와 서버 사이에 낮은 결합도를 유지할 수 있음
- 클래스 내부의 메서드가 아래 조건을 만족하는 인스턴스에만 메시지를 전송하도록 프로그래밍 해야 함.
    - this 객체
    - 메서드의 매개변수
    - this의 속성
    - this의 속성인 컬렉션의 요소
    - 메서드 내에서 생성된 지역 객체
- **부끄럼 타는 코드(shy code)** : 불 필요한 어떤 것도 다른 객체에게 보여주지 않으며 다른 객체의 구현에 의존하지 않는 코드
- **기차 충돌** : 메시지 전송자가 수신자의 내부 구조에 대해 물어보고 반환받은 요소에 대해 연쇄적으로 메시지를 전송하는 것
    - 클래스의 내부 구현이 외부로 노출 됐을 때 나타나는 전형적인 형태

### 2. 묻지 말고 시켜라

- 훌륭한 메시지는 객체의 상태에 관해 묻지 말고 원하는 것을 시켜야 함
- 인터페이스는 객체가 어떻게 하는지가 아니라 무엇을 하는지를 서술해야 함.

### 3. 의도를 드러내는 인터페이스

```java
class PeriodCondition {
  public isSatisfiedByPeriod(screening: Screening): boolean {}
}
class SequenceCondition {
  public isSatisfiedBySequence(screening: Screening): boolean {}
}
```

- 메서드에 대해 제대로 커뮤니케이션을 하지 못함
    - 동일한 작업을 하지만 이름이 다름
- 메서드 수준에서 캡슐화를 위반 한다는 것
    - 책임을 수행하는 방법을 드러내는 메서드를 사용한 설계는 변경에 취약

```java
interface DiscountCondition {
  isSatisfiedBy(screening: Screening): boolean;
}

class PeriodCondition implements DiscountCondition {
  public isSatisfiedBy(screening: Screening): boolean {}
}
class SequenceCondition implements DiscountCondition {
  public isSatisfiedBy(screening: Screening): boolean {}
}
```

- **의도를 드러내는 선택자** : 어떻게 하느냐가 아니라 무엇을 하느냐에 따라 메서드의 이름을 짓는 패턴
- 객체에게 묻지 말고 시키되 구현 방법이 아닌 클라이언트의 의도를 드러내야 함

### 함께 모으기

- 근본적으로 디미터 법칙을 위반하는 설계는 인터페이스와 구현의 분리 원칙을 위반
- 디미터 법칙을 위반한 코드는 결합도가 높고, 요구사항 변경에 취약하고, 사용하기 어려움

---

## 03 원칙의 함정

- 원칙은 예외가 넘쳐남
- 설계는 트레이드 오프의 산물

### 디미터 법칙은 하나의 도트(.)를 강제하는 규칙이 아니다.

- 디미터 법칙은 “오직 하나의 도트만을 사용하라” 라는 말로 요약 됨
- 디미터 법칙은 결합도와 관련된 것이며, 이 결합도가 문제가 되는 것은 객체의 내부 구조가 외부로 노출되는 경우로 한정

### 결합도와 응집도의 충돌

- 위임 메서드를 통해 객체의 내부 구조를 감추는 것은 협력에 참여하는 객체들의 결합도를 낮출 수 있는 동시에 객체의 응집도를 높일 수 있는 효과적인 방법
- 하지만 모든 상황에서 위임 메서드를 추가하면 같은 퍼블릭 인터페이스 안에 어울리지 않는 오퍼레이션들이 공존하게 됨
- 응집도가 낮아짐

---

## 04 명령-쿼리 분리 원칙

- **루틴** : 어떤 절차를 묶어 호출 가능하도록 이름을 부여한 기능 모듈
- **프로시저** : 정해진 절차에 따라 내부의 상태를 변경하는 루틴의 한 종류
- **함수** : 어떤 절차에 따라 필요한 값을 계산해서 반환하는 루틴의 한 종류
- **명령** : 객체의 상태를 수정하는 오퍼레이션
- **쿼리** : 객체와 관련된 정보를 반환하는 오퍼레이션

**함수-프로시저 구분**

- 프로시저는 부수효과를 발생시킬 수 있지만 값을 반환할 수 없음
- 함수는 값을 반환할 수 있지만 부수효과를 발생시킬 수 없음

**명령-쿼리 구분**

- 객체의 상태를 변경하는 명령은 반환값을 가질 수 없음
- 객체의 정보를 반환하는 쿼리는 상태를 변경할 수 없음

명령-쿼리 분리 원칙을 한 문장으로 표현하면 “질문이 답변을 수정해서는 안된다”는 것

### 반복 일정의 명령과 쿼리 분리하기

- 이벤트 : 특정 일자에 발생하는 사건
- 반복 일정 : 일정 시간마다 발생하는 사건
- 메서드가 명령과 쿼리의 두 가지 역할을 동시에 수행하고 있었음
    - 명령과 쿼리의 분리가 필요

### 명령-쿼리 분리와 참조 투명성

**참조 투명성 활용 시 장점**

- 버그가 적음
- 디버깅 용이
- 쿼리의 순서에 따라 실행 결과가 변하지 않는 코드를 작성 가능

- 컴퓨터의 세계와 수학의 세계를 나누는 가장 큰 특징은 **부수효과의 존재 유무**
- 함수는 내부에 부수효과를 포함할 경우 동일한 인자를 전달하더라도 부수효과에 의해 그 결괏값이 매번 달라질 수 있음
- 참조 투명성이란 “ 어떤 표현식 e가 있을 때 e의 값으로 e가 나타나는 모든 위치를 교체하더라도 결과가 달라지지 않는 특성”을 의미

f(1) = 3 

```java
f(1) + f(1) = 6
f(1) * 2 = 6
f(1) -1 = 2

3 + 3 = 6
3 * 2 = 6
3 - 1 = 2
```

- 어떤 값이 변하지 않는 성질을 **불변성**이라고 부름
- 명령형 프로그래밍 : 부수효과를 기반으로 하는 프로그래밍 방식
    - 상태를 변경시키는 연산들을 적절한 순서대로 나열함으로써 프로그램을 작성
- 함수형 프로그래밍 : 부수효과가 존재 하지 않는 수학적인 함수에 기반

### 책임에 초점을 맞춰라

훌륭한 메시지를 얻기 위한 출발점은 책임 주도 설계 원칙을 따르는 것

- **디미터 법칙** : 협력이라는 컨텍스트 안에서 객체보다 메시지를 먼저 결정하면 두 객체 사이의 구조적인 결합도를 낮출 수 있음
- **묻지 말고 시켜라** : 클라이언트 관점에서 메시지를 선택하기 때문에 필요한 정보를 물을 필요 없이 원하는 것을 표현한 메시지를 전송하면 됨
- **의도를 드러내는 인터페이스** : 메시지를 먼저 선택한다는 것은 메시지를 전송하는 클라이언트의 관점에서 메시지의 이름을 정한다는 것
- **명령-쿼리 분리 원칙** : 객체가 어떤일을 해야 하는지뿐만 아니라 협력 속에서 객체의 상태를 예측하고 이해하기 쉽게 만들기 위한 방법에 관해 고민하게 된다.
